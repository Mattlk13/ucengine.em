#!/usr/bin/env ruby

require 'em-ucengine'
require 'optparse'
require 'csv'

class Row2args
    def initialize row
        @name = {
                :name => row.index("name"),
                :password => row.index("password"),
                :role => row.index("role")
        }
    end

    def args row
        {
            :name => row[@name[:name]],
            :password => @name[:password] ? row[@name[:password]] : "pwd",
            :role => @name[:role] ? row[@name[:role]] : nil
        }
    end
end

def load_user_as_csv csv
    cols_name = nil
    CSV.foreach(csv, :col_sep => ";") do |row|
        if cols_name == nil
            cols_name = Row2args.new row
        else
            args = cols_name.args row
            puts args
        end
    end
end

load_user_as_csv ARGV[0]
